<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Solve difference equation — difeq • dde</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Solve difference equation — difeq" />
<meta property="og:description" content="Solve a difference (or recurrence) equation by iterating it a
number of times." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dde</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dde.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mrc-ide/dde/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Solve difference equation</h1>
    <small class="dont-index">Source: <a href='https://github.com/mrc-ide/dde/blob/master/R/difeq.R'><code>R/difeq.R</code></a></small>
    <div class="hidden name"><code>difeq.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Solve a difference (or recurrence) equation by iterating it a
number of times.</p>
    </div>

    <pre class="usage"><span class='fu'>difeq</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>steps</span>, <span class='va'>target</span>, <span class='va'>parms</span>, <span class='va'>...</span>, n_out <span class='op'>=</span> <span class='fl'>0L</span>, n_history <span class='op'>=</span> <span class='fl'>0L</span>,
  grow_history <span class='op'>=</span> <span class='cn'>FALSE</span>, return_history <span class='op'>=</span> <span class='va'>n_history</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, dllname <span class='op'>=</span> <span class='st'>""</span>,
  parms_are_real <span class='op'>=</span> <span class='cn'>TRUE</span>, ynames <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>, outnames <span class='op'>=</span> <span class='cn'>NULL</span>,
  return_by_column <span class='op'>=</span> <span class='cn'>TRUE</span>, return_initial <span class='op'>=</span> <span class='cn'>TRUE</span>, return_step <span class='op'>=</span> <span class='cn'>TRUE</span>,
  return_output_with_y <span class='op'>=</span> <span class='cn'>TRUE</span>, restartable <span class='op'>=</span> <span class='cn'>FALSE</span>,
  return_minimal <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='fu'>difeq_continue</span><span class='op'>(</span><span class='va'>obj</span>, <span class='va'>steps</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>...</span>, copy <span class='op'>=</span> <span class='cn'>FALSE</span>, parms <span class='op'>=</span> <span class='cn'>NULL</span>,
  return_history <span class='op'>=</span> <span class='cn'>NULL</span>, return_by_column <span class='op'>=</span> <span class='cn'>NULL</span>, return_initial <span class='op'>=</span> <span class='cn'>NULL</span>,
  return_step <span class='op'>=</span> <span class='cn'>NULL</span>, return_output_with_y <span class='op'>=</span> <span class='cn'>NULL</span>, restartable <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>

<span class='fu'>yprev</span><span class='op'>(</span><span class='va'>step</span>, i <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>The initial state of the system.  Must be a numeric
vector (and will be passed through <code>as.numeric</code> by this
function).</p></td>
    </tr>
    <tr>
      <th>steps</th>
      <td><p>A vector of steps to return the system at.  The
<em>first</em> step is taken as step zero, and the solution will
be recorded at every other step in the vector.  So to step a
system from time zero to times 1, 2, 3, ..., n use 0:n.  Must be
integer values and will be passed through <code>as.integer</code>
(which may truncate or otherwise butcher non-integer values).</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>The target function to advance.  This can either be
an R function taking arguments <code>n, i, t, y, parms</code> or be a
scalar character with the name of a compiled function with
arguments <code>size_t n, size_t step, double time, const double
*y, double *dydt, size_t n_out, double *output void *data</code>.</p></td>
    </tr>
    <tr>
      <th>parms</th>
      <td><p>Parameters to pass through to the difference function</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Dummy arguments - nothing is allowed here, but this
means that all further arguments <em>must</em> be specified by
name (not order) so I can easily reorder them later on.</p></td>
    </tr>
    <tr>
      <th>n_out</th>
      <td><p>The number of output variables (in addition to the
difference equation variables).  If given, then an R function
must return an <em>attribute</em> <code>output</code> with the output
variables.</p></td>
    </tr>
    <tr>
      <th>n_history</th>
      <td><p>The number of iterations of history to save
during the simulation.  By default, no history is saved.</p></td>
    </tr>
    <tr>
      <th>grow_history</th>
      <td><p>Logical indicating if history should be grown
during the simulation.  If <code>FALSE</code> (the default) then when
history is used it is overwritten as needed (so only the most
recent <code>n_history</code> elements are saved.  This may require
some tuning so that you have enough history to run your
simulation (i.e. to the longest delay) or an error will be
thrown when it underflows.  The required history length will
vary with your delay sizes and with the timestep for dopri.  If
<code>TRUE</code>, then history will grow as the buffer is exhausted.
The growth is geometric, so every time it reaches the end of the
buffer it will increase by a factor of about 1.6 (see the
<code>ring</code> documentation).  This may consume more memory than
necessary, but may be useful where you don't want to care about
picking the history length carefully.</p></td>
    </tr>
    <tr>
      <th>return_history</th>
      <td><p>Logical indicating if history is to be
returned.  By default, history is returned if <code>n_history</code>
is nonzero.</p></td>
    </tr>
    <tr>
      <th>dllname</th>
      <td><p>Name of the shared library (without extension) to
find the function <code>func</code> in the case where <code>func</code>
refers to compiled function.</p></td>
    </tr>
    <tr>
      <th>parms_are_real</th>
      <td><p>Logical, indicating if <code>parms</code> should
be treated as vector of doubles by <code>func</code> (when it is a
compiled function).  If <code>TRUE</code> (the default), then
<code>REAL(parms)</code>, which is <code>double*</code> is passed through.
If <code>FALSE</code> then if <code>params</code> is an externalptr type
(<code>EXTPTRSXP</code>) we pass through the result of
<code>R_ExternalPtrAddr</code>, otherwise we pass <code>params</code>
through unmodified as a <code>SEXP</code>.  In the last case, in your
target function you will need to include <code>&lt;Rinternals.h&gt;</code>,
cast to <code>SEXP</code> and then pull it apart using the R API (or
Rcpp).</p></td>
    </tr>
    <tr>
      <th>ynames</th>
      <td><p>Logical, indicating if the output should be named
following the names of the input vector <code>y</code>.
Alternatively, if <code>ynames</code> is a character vector of the
same length as <code>y</code>, these will be used as the output names.</p></td>
    </tr>
    <tr>
      <th>outnames</th>
      <td><p>An optional character vector, used when
<code>n_out</code> is greater than 0, to name the model output matrix.</p></td>
    </tr>
    <tr>
      <th>return_by_column</th>
      <td><p>Logical, indicating if the output should be
returned organised by column (rather than row).  This incurs a
slight cost for transposing the matrices.  If you can work with
matrices that are transposed relative to <code>deSolve</code>, then
set this to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>return_initial</th>
      <td><p>Logical, indicating if the output should
include the initial conditions.  Specifying <code>FALSE</code> avoids
binding this onto the output.</p></td>
    </tr>
    <tr>
      <th>return_step</th>
      <td><p>Logical, indicating if a row (or column if
<code>return_by_column</code> is <code>TRUE</code>) representing step is included.</p></td>
    </tr>
    <tr>
      <th>return_output_with_y</th>
      <td><p>Logical, indicating if the output
should be bound together with the returned matrix <code>y</code> (as
it is with <code>deSolve</code>).  If <code>FALSE</code>, then output will
be returned as the attribute <code>output</code>.</p></td>
    </tr>
    <tr>
      <th>restartable</th>
      <td><p>Logical, indicating if the problem should be
restartable.  If <code>TRUE</code>, then the return value of a
simulation can be passed to <code>difeq_restart</code> to continue the
simulation after arbitrary changes to the state or the
parameters.  Note that this is really only useful for delay
difference equations where you want to keep the history but make
changes to the parameters or to the state vector while keeping
the history of the problem so far.</p></td>
    </tr>
    <tr>
      <th>return_minimal</th>
      <td><p>Shorthand option - if set to <code>TRUE</code>
then it sets all of <code>return_by_column</code>,
<code>return_initial</code>, <code>return_time</code>,
<code>return_output_with_y</code> to <code>FALSE</code></p></td>
    </tr>
    <tr>
      <th>obj</th>
      <td><p>An object to continue from; this must be the results of
running a simulation with the option <code>restartable =
TRUE</code>.  Note that continuing a problem moves the pointer along
in time (unless <code>copy = TRUE</code>, and that the incoming time
(<code>times[[1]]</code>) must equal the previous time <em>exactly</em>.</p></td>
    </tr>
    <tr>
      <th>copy</th>
      <td><p>Logical, indicating if the pointer should be copied
before continuing.  If <code>TRUE</code>, this is non-destructive with
respect to the data in the original pointer so the problem can
be restarted multiple times.  By default this is <code>FALSE</code>
because there is a (potentially very small) cost to this
operation.</p></td>
    </tr>
    <tr>
      <th>step</th>
      <td><p>The step to access (not that this is not an offset,
but the actual step; within your target function you'd write
things like <code>yprev(step - 1)</code> to get the previous step.</p></td>
    </tr>
    <tr>
      <th>i</th>
      <td><p>index within the state vector <code>y</code> to return.  The
index here is R-style base-1 indexing, so pass <code>1</code> in to
access the first element.  This can be left <code>NULL</code> to
return all the elements or a vector longer than one.</p></td>
    </tr>
    </table>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Here is a really simple equation that just increases by 'p' each</span>
<span class='co'># time (p is the parameter vector and could be any R structure).</span>
<span class='va'>rhs</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span>, <span class='va'>y</span>, <span class='va'>p</span><span class='op'>)</span> <span class='va'>y</span> <span class='op'>+</span> <span class='va'>p</span>

<span class='va'>y0</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>t</span> <span class='op'>&lt;-</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
<span class='fu'>dde</span><span class='fu'>::</span><span class='fu'>difeq</span><span class='op'>(</span><span class='va'>y0</span>, <span class='va'>t</span>, <span class='va'>rhs</span>, <span class='va'>p</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       [,1] [,2]
#&gt;  [1,]    0    1
#&gt;  [2,]    1    6
#&gt;  [3,]    2   11
#&gt;  [4,]    3   16
#&gt;  [5,]    4   21
#&gt;  [6,]    5   26
#&gt;  [7,]    6   31
#&gt;  [8,]    7   36
#&gt;  [9,]    8   41
#&gt; [10,]    9   46
#&gt; [11,]   10   51</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


