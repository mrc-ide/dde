<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Interpolate Dormand-Prince output — dopri_interpolate • dde</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolate Dormand-Prince output — dopri_interpolate"><meta property="og:description" content="Interpolate the Dormand-Prince output after an integration.  This
only interpolates the core integration variables and not any
additional output variables."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dde</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/dde.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/dde/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Interpolate Dormand-Prince output</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/dde/blob/HEAD/R/dopri.R" class="external-link"><code>R/dopri.R</code></a></small>
    <div class="hidden name"><code>dopri_interpolate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Interpolate the Dormand-Prince output after an integration.  This
only interpolates the core integration variables and not any
additional output variables.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dopri_interpolate</span><span class="op">(</span><span class="va">h</span>, <span class="va">t</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>h</dt>
<dd><p>The interpolation history.  This can be the output
running <code>dopri</code> with <code>return_history = TRUE</code>, or the
history attribute of this object (retrievable with
<code>attr(res, "history")</code>).</p></dd>


<dt>t</dt>
<dd><p>The times at which interpolated output is required.
These times must fall within the included history (i.e., the
times that the original simulation was run) or an error will be
thrown.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This decouples the integration of the equations and the generation
of output; it is not necessary for use of the package, but may
come in useful where you need to do (for example) root finding on
the time course of a problem, or generate minimal output in some
cases and interrogate the solution more deeply in others.  See the
examples and the package vignette for a full worked example.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Rich FitzJohn</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Here is the Lorenz attractor implemented as an R function</span></span></span>
<span class="r-in"><span><span class="va">lorenz</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">R</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[[</span><span class="fl">2L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[[</span><span class="fl">3L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="fl">2L</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">R</span> <span class="op">*</span> <span class="va">y</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[[</span><span class="fl">2L</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[[</span><span class="fl">3L</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="va">y</span><span class="op">[[</span><span class="fl">3L</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">y</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[[</span><span class="fl">2L</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Standard parameters and a reasonable starting point:</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">28</span>, <span class="fl">8</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the integration for times [0, 50] and return minimal output,</span></span></span>
<span class="r-in"><span><span class="co"># but *do* record and return history.</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="dopri.html">dopri</a></span><span class="op">(</span><span class="va">y0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, <span class="va">lorenz</span>, <span class="va">p</span>,</span></span>
<span class="r-in"><span>           n_history <span class="op">=</span> <span class="fl">5000</span>, return_history <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>           return_time <span class="op">=</span> <span class="cn">FALSE</span>, return_initial <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>           return_by_column <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Very little output is returned (just 3 numbers being the final</span></span></span>
<span class="r-in"><span><span class="co"># state of the system), but the "history" attribute is fairly</span></span></span>
<span class="r-in"><span><span class="co"># large matrix of history information.  It is not printed though</span></span></span>
<span class="r-in"><span><span class="co"># as its contents should not be relied on.  What does matter is</span></span></span>
<span class="r-in"><span><span class="co"># the range of supported times printed (i.e., [0, 50]) and the</span></span></span>
<span class="r-in"><span><span class="co"># number of entries (~2000).</span></span></span>
<span class="r-in"><span><span class="va">y</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  4.715752</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  7.090322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 17.008255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"history")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;dopri_history&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - equations: 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - time: [0, 50]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - entries: 2128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - order: 5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate an interpolated set of variables using this; first for</span></span></span>
<span class="r-in"><span><span class="co"># 1000 steps over the full range:</span></span></span>
<span class="r-in"><span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu">dopri_interpolate</span><span class="op">(</span><span class="va">y</span>, <span class="va">tt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">yy</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dopri_interpolate-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Then for 50000</span></span></span>
<span class="r-in"><span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu">dopri_interpolate</span><span class="op">(</span><span class="va">y</span>, <span class="va">tt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">yy</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dopri_interpolate-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

